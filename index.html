<!DOCTYPE html>
<html>
<head>
	<title>Space Runaway</title>

	<!-- JAVASCRIPT LINKS -->
	<script type="text/javascript" src="js/class.js"></script>
	<!--
	<script type="text/javascript" src="js/_____.js"></script>
	<script type="text/javascript" src="js/_____.js"></script>
	<script type="text/javascript" src="js/_____.js"></script>
	<script type="text/javascript" src="js/_____.js"></script>
	<script type="text/javascript" src="js/_____.js"></script>
	-->

	<!-- CSS LINK -->
	<link rel="stylesheet" type="text/css" href="style.css">
</head>

<body onload="startGame()">

<script>
	function startGame() {
		entities.player = new Player("images/sprites/player.png", 10, 10, 30); // Removed for now because no images
		Game.start();
	}

	var Game = {
		level : 1,
		canvas : document.createElement("canvas"),
		start : function() {
			this.canvas.width = window.outerWidth-50;
			this.canvas.height = window.innerHeight-40;
			this.ctx = this.canvas.getContext("2d");
			document.body.insertBefore(this.canvas, document.body.childNodes[0]);
			Game.draw();
			// Key handling
			window.onkeydown = this.key_down;
			window.onkeyup = this.key_up;
			// Level
			this.loadLevel(Game.level);
		},
		clear : function() {
			this.canvas.width = this.canvas.width;
		},
		draw : function() {
			Game.clear();

			for (var i in entities) {
				entities[i].draw(Game.ctx);

				if (entities[i].move!==undefined) {
					entities[i].move();
				}
			}
			window.requestAnimationFrame(Game.draw);
		},
		// Key handling
		key_down : function(e) {
			for (var i in entities) {
				if (entities[i].keysDown!==undefined) {
					entities[i].keysDown[e.keyCode]=true;
				}
			}
		},
		key_up : function(e) {
			for (var i in entities) {
				if (entities[i].keysDown!==undefined) {
					delete entities[i].keysDown[e.keyCode];
				}
			}
		},
		// Level loading and parsing
		loadLevel : function(levelNum) {
			// Gets level from server, can't get locally
			var url = "levels/level" + levelNum + ".json";
			var json;
			var xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function() {
				if (xhttp.readyState == 4) {
					json = xhttp.responseText;
				}
			};
			xhttp.open("GET", url, true);
			xhttp.send();

			var obj = {};
			obj.board = JSON.parse(json);
			for (var i = 0; i < obj.board.length; i++) {
				console.log(obj.board[i]);
			}
		}

	}
</script>

</body>

</html>
